-- Nh·∫≠n ki·ªÉu spin t·ª´ b√™n ngo√†i !
local spinType = getgenv().spinType or "Normal"
if spinType ~= "Fast" and spinType ~= "Normal" then
    warn("‚ùå spinType kh√¥ng h·ª£p l·ªá! M·∫∑c ƒë·ªãnh l√† 'Normal'")
    spinType = "Normal"
end

shared.WebhookKaitun = getgenv().Webhook or " "
if #shared.WebhookKaitun > 30 then
shared.kimsoihub = true
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local username = player.Name
local displayName = player.DisplayName
local request = http_request or request or (syn and syn.request) or (fluxus and fluxus.request) or (http and http.request)

if not request then
    return warn("‚ùå Executor kh√¥ng h·ªó tr·ª£ HTTP Request!")
end

-- G√°n h√†m v√†o getgenv ƒë·ªÉ d√πng ·ªü m·ªçi n∆°i
getgenv().sendRareFruitToDiscord = function(result)
    local embedData = {
        title = "üëë KimSoi Hub Stats Notify üëë",
        description = string.format("üôÇ **Name:** @%s (**%s**)", username, displayName),
        color = 0x00ff00,
        fields = {
            {
                name = "üçÄ Got Good Fruit: " .. result,
                value = "‚†Ä",
                inline = false
            }
        },
        footer = {
            text = "üéØ Auto Spin - KimSoi Hub"
        }
    }

    local body = HttpService:JSONEncode({
        username = "KimSoi Hub Webhook",
        embeds = { embedData }
    })

    local response = request({
        Url = shared.WebhookKaitun,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = body
    })

    if response then
        print("‚úÖ ƒê√£ g·ª≠i th√¥ng b√°o tr√°i hi·∫øm:", result)
    end
end
end
--// AUTO REDEEM CODE TR∆Ø·ªöC
task.spawn(function()
    pcall(function()
        local codes = {
            "WOW850", "860KHYPEE", "870OMG!", "LOLX880K!", "IAMLEOPARD",
            "BIGUPDATE20", "ANTICIPATION", "BIGDAY", "MAGNIFICENT890K!!",
            "OMG9HUNDRED!", "WOWZER910", "HYPEE920K!", "930KINS4NITY",
            "940KHAPPYDAYZ", "950KOMGGG!", "LOL960K!"
        }

        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local Replicator = ReplicatedStorage:WaitForChild("Replicator")

        for _, code in ipairs(codes) do
            local args = {"Codes", "Redeem", {["Code"] = code}}
            local success, result = pcall(function()
                return Replicator:InvokeServer(unpack(args))
            end)
            if success then
                print("‚úÖ ƒê√£ th·ª≠ code:", code, "=>", result)
            else
                print("‚ùå L·ªói code:", code)
            end
            task.wait(1)
        end
    end)
end)

--// AUTO NH·∫§N N√öT SPIN + ENTER
local GuiService = game:GetService("GuiService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")
local spinButton = nil

while not spinButton do
    local success, result = pcall(function()
        return gui:WaitForChild("UI"):WaitForChild("MainMenu")
            :WaitForChild("Buttons"):FindFirstChild("Spin")
    end)
    if success and result and result:IsA("GuiButton") and result.Visible then
        spinButton = result
    end
    task.wait(0.2)
end

spinButton.Selectable = true
GuiService.SelectedObject = spinButton
task.wait(0.5)

for i = 1, 3 do
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
    task.wait(0.5)
end

task.wait(1)

--// AUTO SPIN + TH√îNG B√ÅO

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Replicator = ReplicatedStorage:WaitForChild("Replicator")

local rareFruits = {
    "DarkXQuake", "Soul", "DragonV2", "DoughV2", "Nika", "LeopardV2",
    "Ope", "Okuchi", "Lightning", "Chop"
}

local function isRare(fruitName)
    for _, v in ipairs(rareFruits) do
        if string.lower(v) == string.lower(fruitName) then
            return true
        end
    end
    return false
end

local username = player.Name
local currentSlot = 1
local maxSlot = 4
local autoSpin = true

local function showRareFruitNotification(fruitName)
    local gui = player:WaitForChild("PlayerGui"):FindFirstChild("RareFruitNotifier")
    if not gui then
        gui = Instance.new("ScreenGui")
        gui.Name = "RareFruitNotifier"
        gui.ResetOnSpawn = false
        gui.IgnoreGuiInset = true
        gui.Parent = player:WaitForChild("PlayerGui")

        local scroll = Instance.new("ScrollingFrame")
        scroll.Name = "Scroll"
        scroll.Size = UDim2.new(0.6, 0, 0.4, 0)
        scroll.Position = UDim2.new(0.2, 0, 0.3, 0)
        scroll.CanvasSize = UDim2.new(0, 0, 5, 0)
        scroll.ScrollBarThickness = 6
        scroll.BackgroundTransparency = 0.2
        scroll.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        scroll.BorderSizePixel = 0
        scroll.ClipsDescendants = true
        scroll.Parent = gui

        -- N√∫t ‚ùå n·∫±m ·ªü g√≥c ph·∫£i tr√™n c·ªßa khung scroll
        local closeButton = Instance.new("TextButton")
        closeButton.Name = "CloseButton"
        closeButton.Size = UDim2.new(0, 30, 0, 30)
        closeButton.Position = UDim2.new(1, -35, 0, 5) -- n·∫±m ·ªü g√≥c ph·∫£i scroll
        closeButton.AnchorPoint = Vector2.new(0, 0)
        closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        closeButton.BorderSizePixel = 0
        closeButton.Text = "‚ùå"
        closeButton.TextColor3 = Color3.new(1, 1, 1)
        closeButton.TextScaled = true
        closeButton.Font = Enum.Font.FredokaOne
        closeButton.ZIndex = 2
        closeButton.Parent = scroll

        closeButton.MouseButton1Click:Connect(function()
            gui:Destroy()
        end)
    end

    local scroll = gui:FindFirstChild("Scroll")
    if scroll then
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, -10, 0, 30)
        label.Position = UDim2.new(0, 5, 0, #scroll:GetChildren() * 30)
        label.BackgroundTransparency = 1
        label.TextColor3 = Color3.fromRGB(255, 255, 0)
        label.TextStrokeTransparency = 0
        label.Font = Enum.Font.FredokaOne
        label.TextScaled = true
        label.Text = "üéØ " .. username .. " Got Good Fruit: " .. fruitName
        label.ZIndex = 1
        label.Parent = scroll

        scroll.CanvasSize = UDim2.new(0, 0, 0, #scroll:GetChildren() * 30 + 10)
    end
end

local function getEquippedFruit()
    local slot = player:FindFirstChild("MAIN_DATA") and player.MAIN_DATA.Slots[tostring(currentSlot)]
    return slot and slot.Value or nil
end

-- B·∫Øt ƒë·∫ßu v√≤ng l·∫∑p auto spin
while autoSpin do
    local equipped = getEquippedFruit()
    print("Slot", currentSlot, "c·∫ßm:", equipped)

    if equipped and isRare(equipped) then
        if shared.kimsoihub then sendRareFruitToDiscord(equipped) end
        if not shared.kimsoihub then showRareFruitNotification(equipped) end
        if currentSlot < maxSlot then
            currentSlot += 1
            Replicator:InvokeServer("FruitsHandler", "SwitchSlot", {Slot = currentSlot})
            task.wait(1.5)
        else
            print("‚úÖ D·ª´ng spin, ƒë√£ d√πng h·∫øt slot.")
            autoSpin = false
            break
        end
    else
        print("üîÑ Spin ti·∫øp...")

        local spinArgs = spinType == "Fast" and {Type = "Fast"} or {}
        Replicator:InvokeServer("FruitsHandler", "Spin", spinArgs)
    end

    task.wait(1)
end
